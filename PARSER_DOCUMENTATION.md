# Документация парсера МПТ

## Общее описание

Парсер МПТ - это сервис, предназначенный для извлечения данных с официального сайта Московского приборостроительного техникума (https://mpt.ru/raspisanie/). Он позволяет получать информацию о специальностях, группах, текущей неделе и расписании занятий.

## Архитектура

Парсер реализован в виде класса `MptParserService`, который предоставляет методы для извлечения различных типов данных:

1. `parseTabList()` - получение списка специальностей
2. `parseWeekInfo()` - получение информации о текущей неделе
3. `parseGroups([String? specialtyFilter])` - получение списка групп

Также реализован `ScheduleParserService` для парсинга расписания занятий для конкретной группы.

## Модели данных

### TabInfo
Представляет информацию о специальности:
- `href` - хеш-идентификатор специальности
- `ariaControls` - идентификатор элемента управления
- `name` - название специальности

### WeekInfo
Представляет информацию о текущей неделе:
- `weekType` - тип недели (Числитель/Знаменатель)
- `date` - дата
- `day` - день недели

### GroupInfo
Представляет информацию о группе:
- `code` - код группы
- `specialtyCode` - код специальности
- `specialtyName` - полное название специальности

### Lesson
Представляет информацию об уроке:
- `number` - номер пары
- `subject` - название предмета
- `teacher` - преподаватель
- `startTime` - время начала
- `endTime` - время окончания
- `building` - корпус

## Методы парсера

### parseTabList()
Извлекает список специальностей с главной страницы расписания.

**Алгоритм работы:**
1. Отправляет HTTP-запрос к https://mpt.ru/raspisanie/
2. Находит элемент `ul[role="tablist"]` на странице
3. Извлекает все элементы `li[role="presentation"]` с ссылками
4. Создает объекты `TabInfo` для каждой специальности

### parseWeekInfo()
Извлекает информацию о текущей неделе.

**Алгоритм работы:**
1. Отправляет HTTP-запрос к https://mpt.ru/raspisanie/
2. Ищет заголовок `h2` с информацией о дате
3. Ищет заголовки `h3` с информацией о типе недели
4. Создает объект `WeekInfo` с извлеченной информацией

### parseGroups([String? specialtyFilter])
Извлекает список групп. Может работать в двух режимах:

**Без фильтра:** извлекает все группы со страницы
**С фильтром:** извлекает только группы для указанной специальности

**Алгоритм работы (без фильтра):**
1. Отправляет HTTP-запрос к https://mpt.ru/raspisanie/
2. Ищет все заголовки `h2`, `h3`, `h4`, `h5` с текстом, начинающимся на "Группа "
3. Парсит информацию о группах из найденных заголовков

**Алгоритм работы (с фильтром):**
1. Отправляет HTTP-запрос к https://mpt.ru/raspisanie/
2. Получает список специальностей через `parseTabList()`
3. Находит соответствующий элемент `tabpanel` для указанной специальности
4. Ищет заголовки групп только внутри найденного `tabpanel`
5. Парсит информацию о группах из найденных заголовков

### parseScheduleForGroup(String groupCode)
Извлекает расписание занятий для конкретной группы.

**Алгоритм работы:**
1. Отправляет HTTP-запрос к https://mpt.ru/raspisanie/
2. Находит элемент `tabpanel` для указанной группы
3. Извлекает таблицы с расписанием по дням недели
4. Парсит информацию об уроках из таблиц
5. Создает объекты `Lesson` для каждого урока

## Особенности парсинга групп

При парсинге групп сервис извлекает код специальности и её полное название на основе префикса группы. Используется следующее соответствие:

| Префикс | Код специальности | Полное название |
|---------|-------------------|-----------------|
| Э | 09.02.01 Э | 09.02.01 Экономика и бухгалтерский учет |
| СА | 09.02.02 СА | 09.02.02 Сети и системы связи |
| П | 09.02.07 П,Т | 09.02.07 Прикладная информатика, Технологии дополненной и виртуальной реальности |
| Т | 09.02.07 П,Т | 09.02.07 Прикладная информатика, Технологии дополненной и виртуальной реальности |
| ИС | 09.02.07 ИС, БД, ВД | 09.02.07 Информационные системы и программирование, Базы данных, Веб-дизайн |
| БД | 09.02.07 ИС, БД, ВД | 09.02.07 Информационные системы и программирование, Базы данных, Веб-дизайн |
| ВД | 09.02.07 ИС, БД, ВД | 09.02.07 Информационные системы и программирование, Базы данных, Веб-дизайн |
| БАС | 09.02.08 БАС | 09.02.08 Безопасность автоматизированных систем |
| БИ | 38.02.07 БИ | 38.02.07 Банковское дело |
| Ю | 40.02.01 Ю | 40.02.01 Право и организация социального обеспечения |
| ВТ | 09.02.07 ВТ | 09.02.07 Веб-технологии |

## Использование

### Базовый пример
```dart
final parser = MptParserService();

// Получение списка специальностей
final specialties = await parser.parseTabList();

// Получение информации о неделе
final weekInfo = await parser.parseWeekInfo();

// Получение всех групп
final allGroups = await parser.parseGroups();

// Получение групп для конкретной специальности
final groups = await parser.parseGroups('09.02.01 Э');
```

### Парсинг расписания
```dart
final scheduleParser = ScheduleParserService();

// Получение расписания для конкретной группы
final schedule = await scheduleParser.parseScheduleForGroup('П50-5-22');

// Расписание возвращается в виде Map<String, List<Lesson>>
// где ключ - день недели, значение - список уроков
schedule.forEach((day, lessons) {
  print('$day:');
  for (var lesson in lessons) {
    print('  ${lesson.number}. ${lesson.subject} - ${lesson.teacher}');
  }
});
```

## Обработка ошибок

Все методы парсера могут выбрасывать исключения в следующих случаях:
- Таймаут запроса (10-15 секунд)
- Ошибка HTTP (код не 200)
- Не найдены необходимые элементы на странице
- Ошибка парсинга данных

Рекомендуется оборачивать вызовы парсера в блок try-catch для корректной обработки ошибок.

## Оптимизация

Для повышения производительности рекомендуется использовать фильтрацию групп по специальности, что позволяет избежать загрузки и парсинга всей страницы.