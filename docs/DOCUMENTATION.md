# Документация проекта "Мой МПТ"

## Архитектура проекта

Проект следует архитектурному подходу Clean Architecture, который разделяет код на три основных слоя:

### 1. Слой данных (Data Layer)
Отвечает за получение, хранение и управление данными:
- **datasources**: Источники данных (локальные и удаленные)
- **models**: Модели данных
- **parsers**: Парсеры для обработки данных
- **repositories**: Реализации репозиториев

### 2. Доменный слой (Domain Layer)
Содержит бизнес-логику приложения:
- **entities**: Доменные сущности
- **repositories**: Интерфейсы репозиториев
- **usecases**: Бизнес-логика приложения

### 3. Слой представления (Presentation Layer)
Отвечает за отображение данных пользователю:
- **screens**: Экраны приложения
- **widgets**: Компоненты интерфейса

**main.dart**: Точка входа в приложение

## Расписания

### Хранение расписания
Расписание хранится в двух уровнях кэширования:

1. **HTTP-кэш** (в `ScheduleRemoteDatasource`):
   - Хранит сырую HTML-страницу с расписанием
   - Время жизни: 24 часа
   - Цель: уменьшение сетевых запросов

2. **Локальный кэш приложения** (в `ScheduleCacheDataSource`):
   - Хранит структурированные данные расписания
   - Использует SharedPreferences для постоянного хранения
   - Время жизни: 24 часа
   - Структура:
     - `weeklySchedule`: Расписание на неделю (Map<String, List<Schedule>>)
     - `todaySchedule`: Расписание на сегодня (List<Schedule>)
     - `tomorrowSchedule`: Расписание на завтра (List<Schedule>)
     - `lastUpdate`: Время последнего обновления (DateTime)

### Обновление расписания
- **Автоматическое обновление**: Происходит при устаревании данных (более 24 часов)
- **Ручное обновление**: Через экран настроек или при смене группы
- **Процесс обновления**:
  1. Проверяется HTTP-кэш в `ScheduleRemoteDatasource`
  2. При необходимости загружается свежая HTML-страница с сайта техникума
  3. HTML передается `GroupScheduleParser` для парсинга
  4. Структурированные данные сохраняются в локальный кэш через `ScheduleCacheDataSource`

## Замены

### Хранение замен
Замены в расписании хранятся в кэше `ReplacementRemoteDatasource`:
- Использует SharedPreferences для постоянного хранения
- Кэш привязан к конкретной группе (по hash коду группы)
- Время жизни: 15 минут
- Структура: Список объектов `Replacement` с полями:
  - `lessonNumber`: Номер пары
  - `replaceFrom`: Исходный предмет
  - `replaceTo`: Новый предмет
  - `updatedAt`: Время обновления
  - `changeDate`: Дата изменения

### Обновление замен
- **Автоматическое обновление**: Происходит при устаревании данных (более 15 минут)
- **Ручное обновление**: По запросу пользователя через экран настроек
- **Процесс обновления**:
  1. Загружается HTML-страница с изменениями с сайта техникума
  2. Парсится информация о заменах для конкретной группы
  3. Результаты сохраняются в кэш, привязанный к группе

## Группы

### Хранение групп
Информация о группах хранится в кэше `GroupRemoteDatasource`:
- Использует SharedPreferences для постоянного хранения
- Кэш может быть фильтрован по специальности
- Время жизни: 24 часа
- Структура: Список объектов `Group` с полями:
  - `code`: Код группы
  - `specialtyCode`: Код специальности
  - `specialtyName`: Название специальности

### Обновление групп
- **Автоматическое обновление**: При устаревании данных (более 24 часов)
- **Ручное обновление**: При смене специальности или через экран настроек
- **Процесс обновления**:
  1. Загружается HTML-страница с расписанием с сайта техникума
  2. Парсится информация обо всех группах или группах определенной специальности
  3. Результаты сохраняются в кэш

## Специальности

### Хранение специальностей
Информация о специальностях хранится в кэше `SpecialityRemoteDatasource`:
- Использует SharedPreferences для постоянного хранения
- Хранит информацию о вкладках специальностей на сайте техникума
- Время жизни: 24 часа
- Структура: Список Map с полями:
  - `href`: Ссылка на вкладку
  - `ariaControls`: Идентификатор области управления
  - `name`: Название специальности

### Обновление специальностей
- **Автоматическое обновление**: При устаревании данных (более 24 часов)
- **Ручное обновление**: При первом запуске или через экран настроек
- **Процесс обновления**:
  1. Загружается HTML-страница с расписанием с сайта техникума
  2. Парсятся вкладки специальностей
  3. Результаты сохраняются в кэш